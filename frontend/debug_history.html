<!DOCTYPE html>
<html>
<head>
    <title>Debug History</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Debug History API</h1>
    <div id="results"></div>

    <script>
    $(document).ready(function() {
        console.log('Pagina caricata');
        
        // Test API Sessions
        fetch('/api/history/sessions?limit=10')
            .then(response => response.json())
            .then(data => {
                console.log('Sessions API response:', data);
                $('#results').append(`<h2>Sessions (${data.success ? 'OK' : 'ERROR'})</h2>`);
                
                if (data.success) {
                    const sessions = data.sessions || data.data || [];
                    $('#results').append(`<p>Trovate ${sessions.length} sessioni:</p>`);
                    sessions.forEach(session => {
                        $('#results').append(`<div>- ${session.session_id} (${session.symbol}) - ${session.total_trades} trade</div>`);
                    });
                } else {
                    $('#results').append(`<p>Errore: ${data.error}</p>`);
                }
            })
            .catch(error => {
                console.error('Errore sessions:', error);
                $('#results').append(`<p>Errore nel caricamento sessioni: ${error}</p>`);
            });
        
        // Test API Trades
        fetch('/api/history/trades?limit=10')
            .then(response => response.json())
            .then(data => {
                console.log('Trades API response:', data);
                $('#results').append(`<h2>Trades (${data.success ? 'OK' : 'ERROR'})</h2>`);
                
                if (data.success) {
                    const trades = data.data || [];
                    $('#results').append(`<p>Trovati ${trades.length} trade:</p>`);
                    trades.forEach(trade => {
                        $('#results').append(`<div>- ${trade.trade_id} (${trade.symbol}) ${trade.side} - ${trade.status}</div>`);
                    });
                } else {
                    $('#results').append(`<p>Errore: ${data.error}</p>`);
                }
            })
            .catch(error => {
                console.error('Errore trades:', error);
                $('#results').append(`<p>Errore nel caricamento trade: ${error}</p>`);
            });
    });
    </script>
</body>
</html>
